{% extends "layouts/base.html" %}
{% load static %}
{% load humanize %}
{% load pretify_status %}
{% load dict_extras %}
{% block custom_page_css %}
<link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet">
{% endblock %}
{% block browser_title %}Project Brief{% endblock %}
{% block content %}
<section class="flex flex-col flex-1 max-w-[1280px] mx-auto w-full px-2 py-8 gap-8">
	<div class="flex flex-col gap-4">
		<div class="flex flex-wrap items-center justify-between gap-4">
			<div class="flex flex-col gap-3">
				<!-- Title Row -->
				<h1 class="text-title-sm md:text-title-md font-semibold 
					text-gray-700 dark:text-gray-300 
					tracking-tight leading-snug">
					{{ gig.title|truncatewords:8|title }}
				</h1>
				<!-- Status + Visibility Row -->
				<div class="flex flex-wrap items-center gap-2">
					<span class="px-3 py-1 
						bg-green-100 dark:bg-green-900/30 
						text-green-700 dark:text-green-400 
						text-xs font-semibold rounded-full 
						uppercase tracking-wider">
					Confirmed
					</span>
					{% if gig.visibility == 'public' %}
					<span class="px-3 py-1 
						bg-slate-100 dark:bg-slate-800 
						text-slate-600 dark:text-slate-400 
						text-xs font-semibold rounded-full 
						uppercase tracking-wider 
						flex items-center gap-1">
					<span class="material-symbols-outlined text-sm">public</span>
					Public
					</span>
					{% else %}
					<span class="px-3 py-1 
						bg-slate-100 dark:bg-slate-800 
						text-slate-600 dark:text-slate-400 
						text-xs font-semibold rounded-full 
						uppercase tracking-wider 
						flex items-center gap-1">
					<span class="material-symbols-outlined text-sm">visibility_off</span>
					Private
					</span>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
		<div class="lg:col-span-2 flex flex-col gap-6">
			<div class="rounded-2xl bg-white/70 dark:bg-slate-900/70 backdrop-blur 
				border border-slate-200/60 dark:border-slate-800/60 shadow-sm">
				<div class="p-6">
					<div class="flex items-center justify-between mb-6">
						<h3 class="text-base font-semibold tracking-tight text-slate-900 dark:text-white">
							Project Overview
						</h3>
						<!-- Optional trust badge -->
						<span class="inline-flex items-center gap-1 text-xs font-medium 
							text-emerald-600 dark:text-emerald-400">
						<span class="material-symbols-outlined text-xs">lock</span>
						Escrow Protected
						</span>
					</div>
					<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
						<!-- Budget -->
						<div class="flex items-center gap-4 rounded-xl 
							bg-brand-50/80 dark:bg-brand-800/40 px-5 py-4">
							<div class="flex size-10 items-center justify-center 
								rounded-lg bg-brand-500/10 text-brand-600 dark:text-brand-400">
								<span class="material-symbols-outlined">payments</span>
							</div>
							<div class="flex flex-col">
								<span class="text-[11px] uppercase tracking-wider 
									text-slate-500 dark:text-slate-400">
								Total Budget
								</span>
								<span class="text-base font-semibold text-slate-900 dark:text-white">
								${{ gig.total_budget|intcomma }}
								</span>
							</div>
						</div>
						<!-- Timeline -->
						<div class="flex items-center gap-4 rounded-xl 
							bg-blue-50/80 dark:bg-blue-800/40 px-5 py-4">
							<div class="flex size-10 items-center justify-center 
								rounded-lg bg-blue-500/10 text-blue-600 dark:text-blue-400">
								<span class="material-symbols-outlined">calendar_today</span>
							</div>
							<div class="flex flex-col">
								<span class="text-[11px] uppercase tracking-wider 
									text-slate-500 dark:text-slate-400">
								Timeline
								</span>
								<span class="text-base font-medium text-slate-900 dark:text-white">
								{{ gig.gig_duration }}
								</span>
							</div>
						</div>
						<!-- Payment Type -->
						<div class="flex items-center gap-4 rounded-xl 
							bg-emerald-50/80 dark:bg-emerald-800/40 px-5 py-4">
							<div class="flex size-10 items-center justify-center 
								rounded-lg bg-emerald-500/10 text-emerald-600 dark:text-emerald-400">
								<span class="material-symbols-outlined">account_balance_wallet</span>
							</div>
							<div class="flex flex-col">
								<span class="text-[11px] uppercase tracking-wider 
									text-slate-500 dark:text-slate-400">
								Payment Type
								</span>
								<span class="text-base font-medium text-slate-900 dark:text-white">
								Split Payments
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
				<div class="p-6 flex flex-col gap-6">
					<div>
						<h3 class="text-base font-semibold tracking-tight text-slate-900 dark:text-white">Project Description</h3>
						<div class="quill-content max-w-none text-gray-500 dark:text-gray-4=600 space-y-4 leading-relaxed">
							{{ gig.description|safe }}
						</div>
					</div>
					<div class="pt-4 border-t border-slate-100 dark:border-slate-800">
						<a class="inline-flex items-center gap-2 text-brand-500/80 dark:text-gray-500 dark:hover:text-white font-medium text-sm" href="#">
						<span class="material-symbols-outlined text-xl">attachment</span>
						Download Project Brief.pdf
						<span class="text-slate-400 font-normal text-xs">(2.4 MB)</span>
						</a>
					</div>
				</div>
			</div>
			<!-- Required Roles Section -->
			{% if gig.required_roles.all %}
			<div class="my-4">
				<div class="flex justify-between items-center mb-4">
					<h3 class="text-xl font-semibold flex items-center gap-2 text-gray-800 dark:text-gray-400 mb-3">
						<span class="material-symbols-outlined text-pink-500 bg-pink-50 dark:text-gray-500 dark:bg-transparent p-2 rounded-md ">groups</span>
						Required Roles
					</h3>
				</div>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
					<!-- Role Card 1 -->
					{% for role in gig.required_roles.all %}
					<div class="bg-white dark:bg-slate-900 p-5 rounded-xl border border-slate-100 dark:border-slate-800 shadow-sm flex flex-col gap-4 text-gray-800 dark:text-gray-400">
						<div class="flex justify-between items-start">
							<div>
								<h4 class="font-medium text-lg">{{ role.niche_name|truncatechars:24 }}</h4>
								<p class="text-sm text-gray-500">{{ role.role_name|truncatechars:24 }}</p>
							</div>
							<span class="px-2 py-0.5 rounded bg-emerald-100 text-emerald-700 dark:bg-success-900/30 dark:text-success-400 text-[10px] font-medium uppercase">Slots: {{ role.slots }}</span>
						</div>
						<div class="flex items-center gap-3">
							<div class="flex-1">
								<p class="text-sm font-semibold">Payment Plan</p>
								{% with meta=role_payment_meta|get_item:role.id %}
								{% if meta %}
								<p class="text-[11px] text-gray-500">
									{{ meta.type }}
								</p>
								<p class="text-[11px] text-gray-500">
									{{ meta.installments }} payments —
									{% for pct in meta.split %}
									{{ pct }}%{% if not forloop.last %} / {% endif %}
									{% endfor %}
								</p>
								{% endif %}
								{% endwith %}
							</div>
							<button class="text-brand-500 dark:text-gray-400 text-sm font-medium">
							${{ role.budget|intcomma }}
							</button>
						</div>
					</div>
					{% endfor %}
				</div>
			</div>
			{% endif %}
			<!-- <div class="flex flex-col gap-6">
				<div class="flex items-center justify-between">
					<h3 class="text-lg font-semibold">Timeline &amp; Milestones</h3>
					<span class="text-sm font-medium text-slate-500">Total Duration: 10 Weeks</span>
				</div>
				<div class="w-full h-3 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden flex">
					<div class="h-full bg-brand-500 w-1/4"></div>
					<div class="h-full bg-slate-300 dark:bg-slate-700 w-3/4"></div>
				</div>
				<div class="flex flex-col gap-0">
					<div class="relative flex gap-4 pb-8 milestone-line">
						<div class="z-10 size-6 rounded-full bg-brand-500 flex items-center justify-center border-4 border-white dark:border-slate-900 shadow-sm">
							<span class="material-symbols-outlined text-[10px] text-white font-black">check</span>
						</div>
						<div class="flex-1 bg-white dark:bg-slate-900 p-4 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm flex justify-between items-center">
							<div class="flex flex-col">
								<p class="font-semibold text-slate-900 dark:text-white">Architecture Design &amp; Strategy</p>
								<p class="text-xs text-slate-500">Due: Oct 20, 2023</p>
							</div>
							<div class="text-right">
								<p class="font-semibold text-brand-500">$4,500</p>
								<span class="text-[10px] font-semibold text-green-600 dark:text-green-400 uppercase">Released</span>
							</div>
						</div>
					</div>
					<div class="relative flex gap-4 pb-8 milestone-line">
						<div class="z-10 size-6 rounded-full bg-brand-500 flex items-center justify-center border-4 border-white dark:border-slate-900 shadow-sm ring-2 ring-brand-500/20">
						</div>
						<div class="flex-1 bg-white dark:bg-slate-900 p-4 rounded-lg border border-brand-500/30 shadow-sm flex justify-between items-center">
							<div class="flex flex-col">
								<p class="font-semibold text-slate-900 dark:text-white">Core API Development</p>
								<p class="text-xs text-slate-500">Due: Nov 15, 2023</p>
							</div>
							<div class="text-right">
								<p class="font-semibold text-brand-500">$8,000</p>
								<span class="text-[10px] font-semibold text-amber-600 uppercase">In Progress</span>
							</div>
						</div>
					</div>
					<div class="relative flex gap-4 pb-8 milestone-line">
						<div class="z-10 size-6 rounded-full bg-slate-200 dark:bg-slate-800 border-4 border-white dark:border-slate-900 shadow-sm">
						</div>
						<div class="flex-1 bg-white dark:bg-slate-900 p-4 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm flex justify-between items-center opacity-60">
							<div class="flex flex-col">
								<p class="font-semibold text-slate-900 dark:text-white">Integration Testing &amp; QA</p>
								<p class="text-xs text-slate-500">Due: Dec 05, 2023</p>
							</div>
							<div class="text-right">
								<p class="font-semibold text-slate-400">$6,500</p>
								<span class="text-[10px] font-semibold text-slate-400 uppercase">Upcoming</span>
							</div>
						</div>
					</div>
					<div class="relative flex gap-4 milestone-line">
						<div class="z-10 size-6 rounded-full bg-slate-200 dark:bg-slate-800 border-4 border-white dark:border-slate-900 shadow-sm">
						</div>
						<div class="flex-1 bg-white dark:bg-slate-900 p-4 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm flex justify-between items-center opacity-60">
							<div class="flex flex-col">
								<p class="font-semibold text-slate-900 dark:text-white">Final Deployment &amp; Handover</p>
								<p class="text-xs text-slate-500">Due: Dec 20, 2023</p>
							</div>
							<div class="text-right">
								<p class="font-semibold text-slate-400">$6,000</p>
								<span class="text-[10px] font-semibold text-slate-400 uppercase">Upcoming</span>
							</div>
						</div>
					</div>
				</div>
				</div> -->
			<div class="rounded-2xl bg-white/70 dark:bg-slate-900/70 backdrop-blur 
				border border-slate-200/60 dark:border-slate-800/60 shadow-sm">
				<div class="p-8 flex flex-col items-center text-center gap-6">
					<!-- Icon Stack -->
					<div class="relative">
						<div class="absolute inset-0 rounded-full bg-brand-500/20 blur-xl"></div>
						<div class="relative size-16 rounded-2xl bg-white dark:bg-slate-950 
							border border-slate-200 dark:border-slate-800 
							flex items-center justify-center shadow-md">
							<span class="material-symbols-outlined text-3xl text-brand-500">
							timeline
							</span>
						</div>
					</div>
					<!-- Copy -->
					<div class="space-y-2 max-w-sm">
						<h4 class="font-semibold text-lg tracking-tight text-slate-900 dark:text-white">
							Deliverables not finalized yet
						</h4>
						<p class="text-sm text-slate-500 leading-relaxed">
							This project is still in negotiation. Once milestones and release
							schedules are agreed, they’ll appear here.
						</p>
					</div>
					<!-- Divider -->
					<div class="w-full max-w-xs h-px bg-gradient-to-r 
						from-transparent via-slate-200 dark:via-slate-800 
						to-transparent"></div>
					<!-- CTA -->
					{% if can_negotiate %}
					<a href="#deal-room"
						class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl 
						bg-brand-500 text-white text-sm font-semibold
						hover:bg-brand-500/90 transition shadow-lg shadow-brand-500/20">
					Propose Milestones
					<span class="material-symbols-outlined text-base">
					handshake
					</span>
					</a>
					{% else %}
					<span class="text-xs text-slate-400">
					Waiting for the project owner to define deliverables
					</span>
					{% endif %}
				</div>
			</div>
		</div>
		<div class="flex flex-col gap-6">
			<div class="bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 shadow-md p-6">
				<div class="flex flex-col gap-6">
					<div class="flex flex-col gap-1">
						<p class="text-slate-500 text-sm font-medium leading-normal">Total Project Budget</p>
						<p class="text-4xl font-semibold text-slate-800 dark:text-white">${{ gig.total_budget|intcomma }}</p>
					</div>
					<div class="flex items-center gap-2 px-3 py-2 bg-success-500/5 rounded-lg border border-success-500/10">
						<span class="material-symbols-outlined text-success-600 text-xl">verified_user</span>
						<span class="text-xs font-semibold text-success-600 uppercase tracking-tight">Secured by Servio Escrow</span>
					</div>
					<div class="flex flex-col gap-3">
						<button class="w-full py-4 bg-brand-500 text-white rounded-xl font-semibold text-base shadow-lg shadow-brand-500/30 hover:bg-brand-400/90 transition-all">
						Accept Terms
						</button>
						<button class="w-full py-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-semibold text-base hover:bg-slate-50 dark:hover:bg-slate-800 transition-all">
						Send Counteroffer
						</button>
					</div>
					<p class="text-[11px] text-center text-slate-400 px-4">
						By clicking 'Accept Terms', you agree to the project timeline and milestones as outlined.
					</p>
				</div>
			</div>
			<div class="bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm p-6">
				<h3 class="text-sm font-semibold uppercase tracking-wider text-slate-500 mb-6">About the Client</h3>
				<div class="flex flex-col gap-6">
					<div class="flex items-center gap-4">
						<!-- Avatar / Initials -->
						{% if gig.creator.profile.avatar_url %}
						<div class="size-16 rounded-xl bg-cover bg-center shadow-sm"
							style='background-image: url("{{ gig.creator.profile.avatar_url.url }}");'>
						</div>
						{% else %}
						<span class="size-16 rounded-xl bg-brand-500 flex items-center justify-center
							text-white text-2xl font-semibold shadow-sm">
						{{ gig.creator.first_name|slice:":1"|upper }}{{ gig.creator.last_name|slice:":1"|upper }}
						</span>
						{% endif %}
						<div class="flex flex-col">
							<p class="font-semibold text-lg text-slate-900 dark:text-white">{{ gig.creator.full_name|title }}</p>
							<p class="text-sm text-slate-500 font-normal">{{ gig.creator.profile.industry.name }}</p>
							<div class="flex items-center gap-1 mt-1">
								<span class="text-amber-500 font-semibold text-sm">4.9</span>
								<div class="flex gap-0.5">
									<span class="material-symbols-outlined text-amber-500 text-xs fill-1" style="font-variation-settings: 'FILL' 1;">star</span>
									<span class="material-symbols-outlined text-amber-500 text-xs fill-1" style="font-variation-settings: 'FILL' 1;">star</span>
									<span class="material-symbols-outlined text-amber-500 text-xs fill-1" style="font-variation-settings: 'FILL' 1;">star</span>
									<span class="material-symbols-outlined text-amber-500 text-xs fill-1" style="font-variation-settings: 'FILL' 1;">star</span>
									<span class="material-symbols-outlined text-amber-500 text-xs fill-1" style="font-variation-settings: 'FILL' 1;">star</span>
								</div>
							</div>
						</div>
					</div>
					{% if gig.creator.profile.is_business_owner %}
					<div class="flex items-center gap-4 py-4 border-y border-slate-100 dark:border-slate-800">
						<div class="size-10 rounded-lg bg-slate-50 dark:bg-slate-800 flex items-center justify-center border border-slate-100 dark:border-slate-700">
							<span class="material-symbols-outlined text-slate-400">corporate_fare</span>
						</div>
						<div class="flex flex-col">
							<p class="text-xs font-semibold text-slate-400 uppercase">Company</p>
							<p class="text-sm font-semibold text-slate-700 dark:text-slate-300">{{ gig.creator.business_account.business_name|truncatewords:4 }}.</p>
						</div>
					</div>
					{% endif %}
					<div class="flex flex-col gap-2">
						<div class="flex justify-between text-sm">
							<span class="text-slate-500">Member since</span>
							<span class="text-slate-900 dark:text-white font-medium">{{ gig.creator.date_joined|date:"M j, Y" }}</span>
						</div>
						<!-- <div class="flex justify-between text-sm">
							<span class="text-slate-500">Total Spent</span>
							<span class="text-slate-900 dark:text-white font-medium">$120k+</span>
							</div> -->
						<div class="flex justify-between text-sm">
							<span class="text-slate-500">Location</span>
							<span class="text-slate-900 dark:text-white font-medium">{{ creator_location.city }}, {{ creator_location.province }}</span>
						</div>
					</div>
					<!-- <button class="w-full text-center py-2 text-brand-500 font-semibold text-sm hover:bg-brand-500/5 rounded-lg transition-colors">
						View Full Profile
						</button> -->
				</div>
			</div>
			<div class="p-6 bg-slate-100 dark:bg-slate-800/50 rounded-lg border border-dashed border-slate-300 dark:border-slate-700">
				<div class="flex gap-3">
					<span class="material-symbols-outlined text-brand-500 dark:text-slate-400">info</span>
					<div class="flex flex-col gap-1">
						<p class="text-xs font-semibold text-brand-500/90 dark:text-slate-400">Need help with this offer?</p>
						<p class="text-[11px] text-brand-600/70 dark:text-slate-500">Contact our Concierge support if you have questions about the terms or milestones.</p>
						<a class="text-[11px] font-semibold text-brand-500/80 dark:text-slate-400 mt-1" href="#">Chat with an Expert</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock %}
{% block custom_page_js %}
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
{% endblock %}
