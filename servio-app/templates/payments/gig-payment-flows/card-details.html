{% extends "layouts/base.html" %}
{% load static %}
{% load humanize %}
{% block browser_title %}Gig Card Payment Checkout{% endblock %}
{% block content %}

<div class="flex flex-col lg:flex-row gap-8 items-start py-5">
    <!-- Left Column: Payment Form & Card Visualization -->
    <div class="flex-1 w-full flex flex-col gap-6">
        <!-- Secure Badge -->
        <div class="flex items-center gap-2 bg-success-50 dark:bg-success-900/20 text-success-700 dark:text-success-400 px-3 py-2 rounded-lg border border-success-100 dark:border-success-800/30 w-fit">
            <span class="material-symbols-outlined text-lg">lock</span>
            <span class="text-sm font-base">Payments secured with 256-bit SSL encryption</span>
        </div>
        <div class="bg-white dark:bg-[#1a202c] rounded-2xl p-6 lg:p-8 shadow-sm border border-[#e7ebf3] dark:border-gray-800 relative overflow-hidden group/form">
            <!-- Decorative blurred background blob -->
            <div class="absolute -top-20 -right-20 w-64 h-64 bg-brand-500/5 rounded-full blur-3xl pointer-events-none"></div>
                <div class="grid-cols-1 lg:grid-cols-[1.2fr_0.8fr] gap-8 md:gap-12">
                    <!-- Form Fields -->
                    <form class="space-y-4 mb-5">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Card Details</h3>
                        <div class="relative group">
                            <input class="block py-3 px-4 w-full text-base text-gray-800 dark:text-white bg-transparent border-2 border-gray-200 dark:border-gray-700 rounded-xl appearance-none focus:outline-none focus:ring-0 focus:border-brand-500 peer transition-colors" id="cardName" placeholder=" " type="text" />
                            <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-[#1a202c] px-2 peer-focus:px-2 peer-focus:text-brand-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 cursor-text" for="cardName">Name on Card</label>
                        </div>
                        <div class="relative group">
                            <input class="block py-3 px-4 w-full text-base text-gray-800 dark:text-white bg-transparent border-2 border-gray-200 dark:border-gray-700 rounded-xl appearance-none focus:outline-none focus:ring-0 focus:border-brand-500 peer transition-colors" id="cardNumber" placeholder=" " type="text" />
                            <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-[#1a202c] px-2 peer-focus:px-2 peer-focus:text-brand-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 cursor-text" for="cardNumber">Card Number</label>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-2 pointer-events-none opacity-50 peer-focus:opacity-100 transition-opacity">
                                <img alt="Mastercard logo" class="h-5" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAg4jNlnH7syVeiSCBXdUa9nV7F0m2AYnaPqubYxnja4q6Ru9xprKxv50nRF4avIMpy192z2wDnn5dKhBgL3Eic_64hY84ekB9tz8Bz66zyalagXR3pAwss9btzqAHO-fgVvQUyCz4PrQ50zo5uwOQx42Wd6UM6v8ifva__ZG_krJO0WOib3m7JyhBbxc8-PnqALOi84pxZfvh11mBT9rEeCcIDvIl8m0DVayA-Zpvf9dDZTlcyOyRm4UmLHH9KiC3KhO4OEHGO3uo" />
                                <img alt="Visa logo" class="h-5" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDGflaOeByupjOQLEvQwJKAjUWFYOrGHlF44pr5vbZ_kCbcdPbJGXcKhEdi36_AeUW05M9xEQvIU-oAI7pu3nbxAySDGg3wpihBupHsEMJmM6Fng7pftJ6w1JeY95GG_DVHLi9nC8FBzRwhFWDj42fNeZGP1oLvh5KUFOgoOA9XQP5uRUAga0az9AdpTj1jBik1oZcpBOhHCd9caFiwJUIlirZIuxCfP3FkkFn3cxUAGWqj-INAonh5ujC2aHeedntG4dh8hCkw9nA" />
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="relative group flex-1">
                                <input class="block py-3 px-4 w-full text-base text-gray-800 dark:text-white bg-transparent border-2 border-gray-200 dark:border-gray-700 rounded-xl appearance-none focus:outline-none focus:ring-0 focus:border-brand-500 peer transition-colors" id="expiry" placeholder=" " type="text" />
                                <label class="absolute text-xs sm:text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-[#1a202c] px-2 peer-focus:px-2 peer-focus:text-brand-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 cursor-text" for="expiry">Expiry (MM/YY)</label>
                            </div>
                            <div class="relative group flex-1">
                                <!-- 
                                    Note: This input triggers the flip via CSS peer 
                                        selector logic if restructured, but we use JS 
                                        usually. Here we simulate focus effect if user 
                                        clicks it, pretending it flips the card visually
                                -->
                                <input 
                                    class="block py-3 px-4 w-full text-base 
                                        text-gray-800 dark:text-white bg-transparent 
                                        border-2 border-gray-200 dark:border-gray-700 
                                        rounded-xl appearance-none focus:outline-none 
                                        focus:ring-0 focus:border-brand-500 peer 
                                        transition-colors" 
                                    id="cvv" placeholder=" " type="text" 
                                />
                                <label 
                                    class="absolute text-sm text-gray-500 
                                        dark:text-gray-400 duration-300 transform 
                                        -translate-y-4 scale-75 top-2 z-10 origin-[0] 
                                        bg-white dark:bg-[#1a202c] px-2 peer-focus:px-2 
                                        peer-focus:text-brand-500 peer-placeholder-shown:scale-100 
                                        peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 
                                        peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-3 
                                        cursor-text" 
                                    for="cvv"
                                >CVV</label>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg cursor-help" title="3 digits on back of card">help</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-2">
                            <div class="flex items-center gap-3">
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input checked="" class="sr-only peer" type="checkbox" value="" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-brand-500/20 dark:peer-focus:ring-brand-500/30 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-brand-500"></div>
                                    <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Save card for future payments</span>
                                </label>
                            </div>
                        </div>
                    </form>
                    <!-- Interactive Card Preview -->
                    <div class="w-full max-w-[360px] mx-auto flex flex-col items-center pt-2 perspective">
                        <div
                            id="card-preview"
                            class="
                                relative w-full aspect-[85/54]
                                transition-transform duration-500
                                preserve-3d
                                hover:scale-[1.02]
                                md:hover:scale-[1.04]
                                shadow-xl
                                rounded-2xl
                                "
                        >
                            <!-- Front -->
                            <div 
                                class="absolute inset-0 backface-hidden rounded-2xl 
                                    p-6 text-white bg-gradient-to-br from-[#1e3a8a] to-[#020617]"
                            >
                                <div class="flex justify-between items-start">
                                    <span class="material-symbols-outlined text-3xl opacity-80">contactless</span>
                                    <div class="absolute top-4 right-4 flex">
                                        <div class="w-8 h-8 bg-red-500 rounded-full"></div>
                                        <div class="w-8 h-8 bg-yellow-500 rounded-full -ml-4"></div>
                                    </div>
                                </div>

                                <p class="mt-6 font-mono tracking-[0.25em] text-sm md:text-lg">
                                    •••• •••• •••• ••••
                                </p>

                                <div class="flex justify-between mt-6 text-sm">
                                    <div>
                                        <span class="block text-[10px] opacity-70">CARD HOLDER</span>
                                        {{ user.full_name|title }}
                                    </div>
                                    <div class="text-right">
                                        <span class="block text-[10px] opacity-70">EXPIRES</span>
                                        12/25
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-4 text-center">Interactive preview updates in real-time</p>
                    </div>
                </div>
        </div>
        <!-- Action Buttons -->
        <div class="flex flex-col gap-4 mt-2">
            {% if payments %}
                <a href="{% url PAYMENT_URLS.GIG_PAYMENT_RESPONSE gig_id=gig.id %}" class="w-full bg-brand-500 hover:bg-blue-700 text-white font-semibold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition-all active:scale-[0.99] flex items-center justify-center gap-3 group">
                    <span class="material-symbols-outlined group-hover:animate-pulse">lock</span>
                    <span class="text-lg">Pay ${{ gig.total_amount_payable|intcomma }}</span>
                </a>
            {% else %}
                <a @click="showToast('Unable to process card payments, connect a payment processor', 'info', 'Servio Payment service')" class="w-full bg-brand-500 hover:bg-blue-700 text-white font-semibold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition-all active:scale-[0.99] flex items-center justify-center gap-3 group">
                    <span class="material-symbols-outlined group-hover:animate-pulse">lock</span>
                    <span class="text-lg">Pay ${{ gig.total_amount_payable|intcomma }}</span>
                </a>
            {% endif %}
            <p class="text-center text-xs text-gray-400 dark:text-gray-500">
                By confirming your payment, you allow Servio to charge your card for this payment and future payments in accordance with our terms.
            </p>
        </div>
    </div>
    <!-- Right Column: Order Summary -->
    <div class="w-full lg:w-[380px] shrink-0 flex flex-col gap-6">
        <div class="bg-white dark:bg-[#1a202c] rounded-2xl p-6 shadow-sm border border-[#e7ebf3] dark:border-gray-800 sticky top-24">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-6">Order Summary</h3>
            <!-- Gig Item -->
            <div class="flex gap-4 mb-6 pb-6 border-b border-gray-100 dark:border-gray-700">
                <div class="flex flex-col gap-1 space-y-2">
                    <h4 class="font-semibold text-sm text-gray-700 dark:text-white leading-tight">{{ gig.title|striptags|truncatewords:6|title }}</h4>
                    <p class="text-xs text-gray-500 dark:text-gray-400">{{ gig.start_date}} - {{ gig.end_date }}</p>
                </div>
                <div class="ml-auto font-semibold text-sm text-gray-600">${{ gig.total_budget|intcomma }}</div>
            </div>
            <!-- Price Breakdown -->
            <div class="flex flex-col gap-3 text-sm">
                <div class="flex justify-between text-gray-600 dark:text-gray-400">
                    <span>Subtotal</span>
                    <span>${{ gig.total_budget|intcomma }}</span>
                </div>
                <div class="flex justify-between text-gray-600 dark:text-gray-400">
                    <span class="flex items-center gap-1">Service Fee <span class="material-symbols-outlined text-[14px] cursor-help" title="Gateway processing fees">info</span></span>
                    <span>${{ gig.service_fee|intcomma }}</span>
                </div>
                <div class="flex justify-between text-gray-600 dark:text-gray-400">
                    <span class="flex items-center gap-1">Tax <span class="material-symbols-outlined text-[14px] cursor-help" title="GST 7%">info</span></span>
                    <span>${{ gig.tax|intcomma }}</span>
                </div>
                <!-- <div class="flex justify-between text-success-600 font-medium">
                    <span>Discount (New User)</span>
                    <span>-$0.00</span>
                </div> -->
            </div>
            <div class="h-px w-full bg-gray-200 dark:bg-gray-700 my-4"></div>
            <div class="flex justify-between items-end">
                <span class="text-lg font-semibold text-gray-800 dark:text-white">Total</span>
                <div class="flex flex-col items-end">
                    <span class="text-2xl font-black text-brand-500 dark:text-emerald-400">${{ gig.total_amount_payable|intcomma }}</span>
                    <span class="text-xs text-gray-400">USD</span>
                </div>
            </div>
            <div class="mt-6 p-3 bg-success-50 dark:bg-emerald-50 rounded-lg flex gap-3 items-start">
                <span class="material-symbols-outlined text-success-700 dark:text-emerald-600 text-lg mt-0.5">shield_lock</span>
                <div class="flex flex-col gap-1">
                    <p class="text-xs font-semibold text-success-800 dark:text-emerald-600">Servio Money Back Guarantee</p>
                    <p class="text-xs text-success-700 dark:text-emerald-700 leading-relaxed">
                        Your payment is held in escrow until you approve the work.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block custom_page_js %}
{% endblock %}